#!/bin/sh
mkdir "reports_$1"
for report in $(find -iname "*.json"); do
    $(report_file="reports_$1/`basename ${report::-5}`"
      if results=$(jq '.scans | .[].result' "$report" | grep -inE "$1"); then
	  echo "$report" > "$report_file"
	  jq '.scan_date, .first_seen, .times_submitted' "$report" >> "$report_file"
	  echo "$results" >> "$report_file"
	  mv "$report_file" "reports_$1/$(sed -n '5{p;q}' $report_file | sed 's/.*://g' | sed 's/\"//g' | sed 's;/;.;g')_$(basename $report_file)"
    fi) &
done
